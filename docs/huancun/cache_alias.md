# Problema de alias de caché

En la arquitectura NanHu, tanto DCache como ICache utilizan una estructura asociativa de 8 vías de 128 KB, y la cantidad de bits ocupados por el índice de caché y el desplazamiento de bloque supera el desplazamiento de página (el desplazamiento de página de una página de 4 K es de 12 bits). Esto introduce la caché Problema de alias: cuando dos páginas virtuales se asignan a la misma página física, es probable que los bits de alias de las dos páginas virtuales sean diferentes. Si no se realiza ningún procesamiento adicional, el índice VIPT (después de agregar la etiqueta física del índice virtual) Las páginas virtuales se ubicarán en diferentes conjuntos de la memoria caché, lo que provocará que dos copias del bloque físico perteneciente a la misma página física se almacenen en la memoria caché, lo que provoca algunos errores de coherencia.

![](../figs/huancun_cache_alias-1.jpg)

Para permitir que L1 Cache continúe usando VIPT, el sistema de caché de XiangShan utiliza hardware para resolver el problema de alias de caché. La solución específica es que el caché L2 garantice que un bloque físico tenga como máximo un bit de alias en un caché VIPT en el nivel superior.

El siguiente es un ejemplo para ilustrar cómo L2 resuelve el problema del alias de caché. Como se muestra en la figura siguiente, hay un bloque con una dirección virtual de 0x0000 en DCache. Las direcciones virtuales 0x0000 y 0x1000 están asignadas a la misma dirección física y los alias de estas dos direcciones son diferentes. En este momento, DCache adquiere La dirección de 0x1000 y el alias (0x1) registrados en el campo de usuario de la solicitud de adquisición. Después de leer el directorio, L2 encontró que la solicitud se había realizado correctamente, pero el alias de adquisición (0x1) y el alias de DCache (0x0) registrados por L2 en la dirección física son diferentes. Luego, L2 iniciará una subsolicitud de sondeo y registrará el alias (0x0) que se va a sondear en el campo de datos de sondeo. Una vez que se completa la subsolicitud de sondeo, L2 devuelve el bloque a DCache y cambia el El alias en el directorio del cliente L2 es (0x1).

![](../figs/huancun_cache_alias-2.jpg)
